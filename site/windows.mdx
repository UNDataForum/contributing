export const name = 'Windows'

# Developing on Windows

Despite [Windows Subsystem for Linux (WSL)](https://docs.microsoft.com/en-us/windows/wsl/install-win10), getting a front-end development stack up and running on Windows 10 is still quite hard. It's nothing like a Linux or Mac experience. We are developing on Windows 10 and since it was too much hassle to have each developer manually configure their development environment, we have chosen to go the [Docker](https://www.docker.com/) route to help developers get up and running fast. This tutorial helps you get up and running on Windows 10 with any [@UNDataForum repository on GitHub](https://github.com/undataforum).

## Prerequisites

You need local admin privileges on your Windows 10 machine and an account at https://hub.docker.com/.

## Set HOME

To ensure that Powershell uses the correct home directory, set an environment variable `HOME` for your account with value `%USERPROFILE%`.

## Install Docker

Download and install [Docker Desktop](https://www.docker.com/products/docker-desktop) for Windows. You need to add yourself to group `docker-users`.

## Install Visual Studio Code

You can use your preferred editor or IDE. If you are not yet invested into an editor or IDE we recommend using [Visual Studio Code](https://code.visualstudio.com/). Change the following settings:

| Setting | Value | Comment |
|:--------|:------|:--------|
| `editor.formatOnSave` | `true` | Turn on format on save. Required for Prettier plugin. |
| `files.autoSave` | `onFocusChange` | Save editor when losing focus. |
| `files.eol` | `\n` | Change line endings to LF for Docker compatibility. |
| `telemetry.enableCrashReporter` | `false` | Disable crash reporter. |
| `telemetry.enableTelemetry` | `false` | Disable telemetry. |

Install the following extensions:

- [ESLint](https://marketplace.visualstudio.com/items?itemName=dbaeumer.vscode-eslint)
- [Prettier](https://marketplace.visualstudio.com/items?itemName=esbenp.prettier-vscode)
- [vscode-styled-components](https://marketplace.visualstudio.com/items?itemName=jpoissonnier.vscode-styled-components)
- [Bracket Pair Colorizer](https://marketplace.visualstudio.com/items?itemName=CoenraadS.bracket-pair-colorizer)
- [Docker](https://marketplace.visualstudio.com/items?itemName=PeterJausovec.vscode-docker)
- [MDX](https://marketplace.visualstudio.com/items?itemName=silvenon.mdx)

## Install Git for Windows

Install [Git for Windows](https://git-scm.com/download/win). Choose Visual Studio Code as preferred editor. You also can set your preferred editor manually. Next configure your global `.gitconfig`. Run

```powershell
git config --global user.name "<your_name>"
```

and

```powershell
git config --global user.email "<your_email>"
```

Your `user.email` can be your GitHub login email. You can also use an alternate email, but then you need to add it as secondary email to your GitHub account to get credit for your commits. See https://github.com/settings/emails.

Verify that there is a `.gitconfig` in your `%USERPROFILE%` and run

```powershell
git config --list
```

to verify that your settings have been applied.

There is no need to use a Git client. Instead use the command-line and create an alias for this customized Git log.

```powershell
git config --global alias.lg "log --graph --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)<%an>%Creset' --abbrev-commit --exclude=*gh-pages --all"
```

You can now type `git lg` to see the commit tree on the command-line.

## How to use Docker

Unless otherwise noted in the `README` files of each repository, we use Docker Hub image [`mhart/alpine-node:8`](https://hub.docker.com/r/mhart/alpine-node/) for web development workflow. This is image is small in size and [Node](https://nodejs.org/) and [Yarn](https://yarnpkg.com/) installed. Yarn is the package manager of choice across [all @UNDataForum repositories](https://github.com/UNDataForum).

To execute Yarn via Docker, run

```powershell
docker run --rm -it -v ${pwd}:/project -w /project mhart/alpine-node:8 yarn
```

from the project root. This spins up an emphemeral container that maps the project root to `/project`, sets it as working directory and then runs `yarn`. For yarn commands requiring access to a specific port, such when running `yarn start` in most repositories, add the `-p` option to map the port of the container to a port on your host machine:

```powershell
docker run --rm -it -v ${pwd}:/project -w /project -e CHOKIDAR_USEPOLLING=true -p 8000:8000 mhart/alpine-node:8 yarn start
```

Setting `CHOKIDAR_USEPOLLING` to `true` with option `-e` ensures that HMR works within the docker container (see [here](https://github.com/facebook/create-react-app/blob/master/packages/react-scripts/template/README.md#npm-start-doesnt-detect-changes)).

Typing out this command is a hassle compared to just typing `yarn start` as you would if you were developing with Yarn installed on your host machine. Create a Powershell alias. Create file `%UserProfile%\Documents\WindowsPowerShell\profile.ps1` and add the following code:

```powershell
function Docker-Yarn {
  docker run --rm -it -v ${pwd}:/project -w /project -e CHOKIDAR_USEPOLLING=true -p 8000:8000 mhart/alpine-node:8 yarn $args
}
New-Alias yarn Docker-Yarn
```

To make this alias work, you may have to run

```powershell
Set-ExecutionPolicy RemoteSigned 
```

in a powershell with admin privileges. Restart your powershell and run

```powershell
yarn --version
```

from a project root. Remember that Yarn runs inside a Docker container, but it seems it is running locally.

One final note on the `-p` option in of the aliased Docker command. 
